$Application ExitOnReturnOn

set pvWindow [$Application GetMainWindow]
set pv(vtkTemp43) [$pvWindow GetMainView]

if {[info exists argc]} { 
    set argcm1 [expr $argc - 1]
    for {set i 0} {$i < $argcm1} {incr i} {
        if {[lindex $argv $i] == "-D" && $i < $argcm1} {
		set DataDir [lindex $argv [expr $i + 1]]
        }
        if {[lindex $argv $i] == "-UC" && $i < $argcm1} {
            set kw(vtkTemp92) [$pv(vtkTemp43) GetRenderModuleUI]
            catch {$kw(vtkTemp92) SetCompositeThreshold 0}
        }
    }
} 

$pv(vtkTemp43) SetOrientationAxesVisibility 0
$pv(vtkTemp43) SetBackgroundColor 0 0 0

$pvWindow Open "$DataDir/Data/blow data.vtk"

set pvWarp [$pvWindow CreatePVSource WarpVector]
$pvWarp UpdateParameterWidgets
$pvWarp AcceptCallback

set warpOutput [$pvWarp GetPVOutput]
$warpOutput SetVisibility 0

set pvWindow [lindex [vtkPVWindow ListInstances] 0]
$pvWindow SetCurrentPVSourceCallback $pvWarp

set MainView [[$Application GetMainWindow] GetMainView]
$MainView SetCameraState 143.632 4.67034 -39.8384 2 12 4.1578e-15 0.270701 -0.00149368 0.962662

[$pvWarp GetPVWidget {Vectors}] SetValue displacement1
$pvWarp AcceptCallback

set MainView [[$Application GetMainWindow] GetMainView]
$MainView SetRenderWindowSize 300 300

for {set i 1} {$i <= 2} {incr i 1} {
	[$pvWarp GetPVWidget {Vectors}] SetValue displacement$i
        $pvWarp AcceptCallback
	update

}

set warpOutput [$pvWarp GetPVOutput]

[$pvWarp GetPVWidget {Vectors}] SetValue displacement1
[$warpOutput GetColorMenu] SetValue "Point thickness1"
$warpOutput ColorByPointField thickness1 1
$pvWarp AcceptCallback

$warpOutput SetVisibility 1

for {set i 8} {$i <= 10} {incr i 1} {
    [$pvWarp GetPVWidget {Vectors}] SetValue displacement$i
    [$warpOutput GetColorMenu] SetValue "Point thickness$i"
    $warpOutput ColorByPointField thickness$i 1
    $pvWarp AcceptCallback
    update

}

update
[[$Application GetMainWindow] GetMainView] ForceRender

for {set i  1} {$i < [expr $argc - 1]} {incr i} {
    if {[lindex $argv $i] == "-C"} {
	source [lindex $argv [expr $i + 1]]
	$Application SetExitStatus [CompareImage [[$Application GetMainWindow] GetMainView]]
    }
}

$Application Exit
