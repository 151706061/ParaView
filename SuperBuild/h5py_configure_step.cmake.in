message("Configuring h5py:\n@h5py_binary@\n@HDF5_DIR@")
set(ENV{LD_LIBRARY_PATH} "@python_install@/lib")
set(ENV{VS_UNICODE_OUTPUT} "")


file(TO_NATIVE_PATH "@HDF5_install@" hdf5_install)

set(ENV{HDF5_DIR} "${hdf5_install}")

if(APPLE)
  set(ENV{CFLAGS} "-arch x86_64 -mmacosx-version-min=@CMAKE_OSX_DEPLOYMENT_TARGET@ -isysroot @CMAKE_OSX_SYSROOT@")
endif()


if(WIN32)

execute_process(
  COMMAND "@PYTHON_EXECUTABLE@" setup.py configure --api=18
  WORKING_DIRECTORY "@h5py_binary@"
  RESULT_VARIABLE res
  )
else()
execute_process(
  COMMAND "@PYTHON_EXECUTABLE@" setup.py configure --hdf5="${hdf5_install}" --api=18
  WORKING_DIRECTORY "@h5py_binary@"
  RESULT_VARIABLE res
  )
endif()

if(NOT ${res} EQUAL 0)
  message(FATAL_ERROR "Error in config of h5py")
endif()
message("h5py config worked.")
