set kw(vtkTemp1) [$Application GetMainWindow]
set kw(vtkTemp22) [$kw(vtkTemp1) GetMainView]

source [file join [file dirname [info script]] CommandLineOptions.tcl]
ParseCommandLine $kw(vtkTemp22) $argv $argc

# Disable popup message dialogs.
$kw(vtkTemp1) SetUseMessageDialog 0

set pvWindow $kw(vtkTemp1)

# Choose the file name/type based on whether we are in parallel mode.
set nprocs [$Application GetNumberOfPartitions]

set ext "vtk"
if {$nprocs > 1} { set ext "pvtp" }

$pvWindow Open "$DataDir/Data/blow data.vtk"
if { [catch {
  $pvWindow ShowCurrentSourceProperties
  $pvWindow WriteVTKFile "$TempDir/vtkParaViewWriteTest.$ext"
  $pvWindow WriteVTKFile "$TempDir/vtkParaViewWriteTestGhost.$ext" 3
  
  # Barrier after write.  We don't want to delete files before they
  # are written.
  $Application SendStringToClientAndServer {
    Invoke id(2) GetController
    Invoke result() Barrier
  }

  file delete -force "$TempDir/vtkParaViewWriteTest.$ext"
  file delete -force "$TempDir/vtkParaViewWriteTestGhost.$ext"

  
  if {$nprocs > 1} {
    # Delete the temporary file's pieces.
    for {set i 0} { $i < $nprocs } { incr i } {
      catch { file delete -force "$TempDir/vtkParaViewWriteTest_$i.vtp" }
      catch { file delete -force "$TempDir/vtkParaViewWriteTestGhost_$i.vtp" }
    }
  }

} res ] != 0 } {
	puts "Error: $res"
	$Application SetExitStatus 1
}

$Application Exit
